To set up osquery for macro malware analysis, you will need to create a configuration file that specifies which data you want to collect and how you want to collect it. Here is an example configuration file that can be used for macro malware analysis:
{
  "schedule": {
    "macros": {
      "query": "SELECT * FROM macro_execution_events WHERE path LIKE '%.docm' OR path LIKE '%.xlsm' OR path LIKE '%.pptm'",
      "interval": 60
    }
  },
  "file_paths": {
    "macropath": ["/Users/*/.office/"]
  },
  "file_events": {
    "enable_compression": "true",
    "file_access": [
      {
        "path": "${macropath}/*",
        "columns": [
          "path",
          "target_path",
          "action",
          "uid",
          "gid",
          "mode",
          "timestamp",
          "sequence",
          "md5",
          "sha256",
          "directory",
          "symlink_target",
          "query_time"
        ]
      }
    ]
  },
  "event_publisher": {
    "enables": [
      "file_events"
    ]
  }
}


In this configuration file, we have set up a scheduled query that collects data from the macro_execution_events table, which contains information about macro executions on the system. We are only interested in .docm, .xlsm, and .pptm files, which are common file extensions for Office documents that can contain macros.

We have also specified a file path that contains macros in the file_paths section. This allows us to monitor changes to the specified path using the file_events section. The file_access section specifies which columns we want to collect when a file event occurs.

Finally, we have enabled the file_events publisher in the event_publisher section, which sends the collected data to a configured endpoint or database.

This is just an example configuration file, and you may need to modify it to suit your specific use case. However, it provides a starting point for setting up osquery for macro malware analysis.